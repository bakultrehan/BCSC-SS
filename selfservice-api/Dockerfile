FROM python:3.7

# Using arguments to make it available in build
ARG DATABASE_TEST_USERNAME
ARG DATABASE_TEST_PASSWORD
ARG DATABASE_TEST_NAME
ARG DATABASE_TEST_HOST
ARG DATABASE_TEST_PORT
ARG JWT_OIDC_AUDIENCE
ARG JWT_OIDC_ISSUER
ARG JWT_OIDC_ALGORITHMS

ENV DATABASE_TEST_USERNAME=${DATABASE_TEST_USERNAME}
ENV DATABASE_TEST_PASSWORD=${DATABASE_TEST_PASSWORD}
ENV DATABASE_TEST_NAME=${DATABASE_TEST_NAME}
ENV DATABASE_TEST_HOST=${DATABASE_TEST_HOST}
ENV DATABASE_TEST_PORT=${DATABASE_TEST_PORT}
ENV JWT_OIDC_AUDIENCE=${JWT_OIDC_AUDIENCE}
ENV JWT_OIDC_ISSUER=${JWT_OIDC_ISSUER}
ENV JWT_OIDC_ALGORITHMS=${JWT_OIDC_ALGORITHMS}

COPY /selfservice-api/. /app
RUN set -x \
	&& chmod -R 777 /app
    
WORKDIR /app

RUN pip install .

EXPOSE 5000